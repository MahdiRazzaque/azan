// src/config/config-validator.js
import { config } from 'dotenv';

// Load environment variables
config();

/**
 * Validate environment variables
 * @returns {boolean} - Whether environment variables are valid
 */
function validateEnv() {
    if (!process.env.ADMIN_USERNAME || !process.env.ADMIN_PASSWORD_HASH) {
        console.error("Error: ADMIN_USERNAME and ADMIN_PASSWORD_HASH are required in .env file");
        process.exit(1); // Exit if critical env vars are missing
    }
    if (!process.env.SALT) {
        console.warn("Warning: SALT environment variable is not set. This is crucial for password security. A default might be used or generated by hashing logic, but it's best to set a persistent one.");
        // Depending on your security model, you might want to make this an error:
        // console.error("Error: SALT environment variable is required in .env file for password security.");
        // process.exit(1);
    }
    // Add check for VOICEMONKEY_TOKEN if it's absolutely critical for startup
    if (!process.env.VOICEMONKEY_TOKEN) {
        console.warn("Warning: VOICEMONKEY_TOKEN is not set in .env file. Alexa announcements will fail.");
    }
    return true;
}

/**
 * Validate configuration object (from file or otherwise)
 * @param {Object} configToValidate - Config object to validate
 * @returns {boolean} - Whether configuration is valid
 */
function validateConfig(configToValidate) {
    try {
        if (!configToValidate) {
            console.error("Error: Configuration object is null or undefined.");
            return false;
        }
        // Validate prayer data configuration
        if (!configToValidate.prayerData) {
            console.error("Error: prayerData configuration is missing");
            return false;
        }

        if (!['mymasjid', 'local'].includes(configToValidate.prayerData.source)) {
            console.error("Error: prayerData.source must be either 'mymasjid' or 'local'");
            return false;
        }

        if (configToValidate.prayerData.source === 'mymasjid' &&
            (!configToValidate.prayerData.mymasjid || !configToValidate.prayerData.mymasjid.guildId)) {
            console.error("Error: guildId is required when using mymasjid as prayer data source");
            return false;
        }

        // Add more checks for other sections if necessary
        if (!configToValidate.features) {
             console.error("Error: features configuration is missing");
             return false;
        }
        if (!configToValidate.auth) {
             console.error("Error: auth configuration is missing");
             return false;
        }
        if (!configToValidate.prayerSettings || !configToValidate.prayerSettings.prayers) {
             console.error("Error: prayerSettings or prayerSettings.prayers configuration is missing");
             return false;
        }

        return true;
    } catch (error) {
        console.error('‚ùå Failed to validate configuration:', error);
        return false;
    }
}

// Export functions
export { validateEnv, validateConfig };